<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="593px" preserveAspectRatio="none" style="width:822px;height:593px;" version="1.1" viewBox="0 0 822 593" width="822px" zoomAndPan="magnify"><defs><filter height="300%" id="fpzi1p80eeyws" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="98" x2="98" y1="86" y2="581.7344"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="295" x2="295" y1="86" y2="581.7344"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="487" x2="487" y1="86" y2="581.7344"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="694" x2="694" y1="86" y2="581.7344"/><rect fill="#FFFFFF" filter="url(#fpzi1p80eeyws)" height="78" style="stroke: #FF9900; stroke-width: 1.5;" width="177" x="8" y="3"/><image height="64" width="64" x="15" xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAIAAAAlC+aJAAAC8ElEQVR4Xu1asW7jMAzth98fND/gHzC6G7gbMxVdCnQpUNx0wA258VB46KgSJkowJE1RkWLXiB8egoC0rfcsSrIS36WN404GtoabNDB+vCODQR2JBIO4xED/1B1+/YBPikDbEAEe335S8PT/LwbhCwXhAAxyufqCcewGJuwG5AXjuAED0Dy0Orw8ELvjPYrgQYxAiiIoC5WVnguERrnzOWQMPP95xKuvRRAgNZ3DM0A1cJhuz8Kkpv1+8AxQvf7+9ypz1wc0iq3zcaXhGcDqhJshE0sB+wFkyATDbuCauDEDsLLAhM2JY2h1A4dpJeHki+CZATxa0DQAB/NFp57mszSfTDlnDcR7YPhaPltxsOqkrAc0UKVvoFMLUCmzBswUocoApMyujwNOd1Q6KUKtAREHQbDyF7lyVDopwpmB8WtvisRhoFUmywAOa6wHbNV/hiE4KjGFRc/Jj7lwFhIGqBLEiZGuyBrQ5JdtY4DuPXyBB2CawfrAHqWlAXju48TzswbIORdBlsQMqKnPJZAAIcw2oKEL3UzRtoFvPkp3Qo4BM0VoYIB6gBcMryKf6xtITO41xoCZIpwZgGLgRB0RA1edhUCGEMaPaTMLJWsdEOrHmTUua0DTHsSVBhCmSt9bMwOpooQcZKsrayBaQhqOSiclwAc0jG/qChrfWQNmilBlAHX4FHITs4Sd4Kh0UoRaA0GaaxwWg6PSSRGqHiUO4R7gIujcYA90wUeJJrOQBq8iPgZIcdaA5qIG6mchTdtAmhrjxJtnqowbSNPszMfMULgO9MENjYaj0knNYbTWuBQwYKYItQa0oCKM627qMVtJqivZRqkBLHo9A3augVY0VZI9IYx3+4Wz0Lj1nxaXQVkPaAzzY2AZlI0Bjd1ALW7ewHHrf7Oetv5Hdyr/ga05q141QJzUyx50dYrwRUMHe+tlDx7UFxxavexhApX1W3ndRkO3txuQF4xjNzBhYwZGa2/qBHUkEgziEgPfCruBtfEJ2LdbK6cL2EAAAAAASUVORK5CYII=" y="10"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="93" x="85" y="24">«IoTGeneric»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="27" x="118" y="40.2969">123</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="10" x="126.5" y="54.5938">[]</text><rect fill="#FFFFFF" filter="url(#fpzi1p80eeyws)" height="78" style="stroke: #FF9900; stroke-width: 1.5;" width="188" x="199" y="3"/><image height="64" width="64" x="206" xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAIAAAAlC+aJAAAEeklEQVR4Xt1au67TQBC9H84fkB/wD1j0kaBMhWgi0VwJpUKiCCVCLiiXYSc+OZ7Zlx0n8eVoFPludtdz5rVj576EN44XO7AUw5/fKvaLO+MmAudfPw7fPvZfuu7wfvfpnYpcy4iMn36+2gV3wEICx++fWemcyByZaRevitkExK5Gdflz//WDmFx0lU+5Fg+YCffzxjwCoiKrJepKFNlJEZIMxksy2U5aAzMIiAasTUu+yhxeJc6xM25GKwG2/dx4EC/BFatzaCIgGizWXiGuAId1Y6mJAJLylpLCHHKZswB1Agie270v3tOtxCI6IqxkUG4hIhcteWVQJ6Bmk88Fu3uIFeBMiSVfkecGWIUAbDZ33xzECqxxUsQ/7caqEIDB2nesAnvuxqNamyg+NxBjVVQI6I7t27UANc0nldCYWzBKBODuteIH0ASwoxEoVvJpv0uhRACmajTGWsDh3XLmlAggg1s2WhEwXM5LjBIBnAAPJhCodlcPhzQBWcYt8YNDKIwEVPRwyNFIEOAyp+tzi+8HY0FVI2nHCQGuYrtY5lZsWhZADwdWyWfFhACmyoWqLp/6hPV4kfvC83zGGQ5XAkjZnk5yE04PFo4ZfqjgonIhwMcHRzwIyLgKLISRnLRM84bXcU8gUHnt6Iy7EID5zRolwAtkFzFAY25Us1+7IBYdTCoTUmfchUA/Rr+5pSHAEcWR5qH1oCu+j+CogGjFzBHAV+ijLgR0o941bUzA54OfD8Aiu/zzFz/vQ7oYw3rtCYRxZ9j0HwEs8EVKle5jUcINuEgnDWw0U53sJJomF4fx4UYdq+NJAlile7YSMH1R4R5czeC0pK+giv6JexU2D4sJwAN67ZNJAZ6624le4yFqAd5E9lSv3kTA34NzgMNaxceGT0oWwzaZA1UC8OqVQHCZATCBYdpoyKDPzlkEEGwsVQJG1QsBGMPo5M+BU3wLkszdEEnKDjmxs8fdIKexec4R8MFyIcAhfp1O/uqpRVHBiBFM8NIyWcdzBHzuXXuh/agrL8PgU8QQ4FKOwSsBeIdXasnvXA/zAOnHjlhxLjdzClMETYV5IjjdTa2fEAiZnzCexURufaz9SmIJhEyP5V38ADEK+JwOSQIKQ/2J0s19qGeoEw/xp7vHizYjVqcpKgS2D0tgcI9IWxOj8IQAl6DNiknlCYH9U8/dRtlPW+YEAS1YGxStinUCferpaQvQJq9OoHNPBUN8xXeI/w3h0yiHIT4/9MWXF8AQf670wnNaPWAInNx/dxxTJ6IHMsrcMgm00Ea4d1hCAB2skSqH47SgVefnTn1WdwkBWFGDB+2qDzNGknbyiQxQ5bSFPseXf15dPxKqBLAvRsxLgSRgTo1jvS5z9sq1jIR7EIDTEL5YUkgGr1zLSKgSmBtCHPpcwnnQromApVB/vLp+JFQJJKO5oIef6cWuiUDUGbmVQJhZRnN6QHKuu1cZVbQfZEPxvdA5/3SaW8hzWgn8D63EIb7v3pq0emDjUiJgzv9tiikhEwLhrT9SvkX8BdDjQDnPYzCsAAAAAElFTkSuQmCC" y="10"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="94" x="281" y="24">«IoTShadow»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="27" x="314.5" y="40.2969">123</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="104" x="276" y="54.5938">[Device Shadow]</text><rect fill="#FFFFFF" filter="url(#fpzi1p80eeyws)" height="78" style="stroke: #FF9900; stroke-width: 1.5;" width="168" x="401" y="3"/><image height="64" width="64" x="408" xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAIAAAAlC+aJAAACcUlEQVR4Xu2ZwUoEMQyG99l9Ax/BFxC8edWzB29e9VwWZEEQYdGwgVCaNn+nTacudPjxMI01X/5OMusewv3NVeugb12XFsBsLYDZWgCztQBmqxHg+Hh7enmolP51RzUC/IT33+prKEMXwNfbk653LAqgsPPXp97BS10AdJD0UjZynAnDAT6f7yiS4vWSi4YDSDCR6KV+7QFA52ecCXsAkOg5HmTCTgDjTOgCoIoSQyIdHC6Db5AJXQD6ovslBjbh++NVL/WoEYAmFOVKRRUJUqnliwklwjY1AmQFWz4PZl8TPAECmrtUe3bJ0QRnANht2AT6qZfa5AwQUMt3N8EfAJpAz4CjCT4AlE2cUI0JFONiggMAN5844z1NcACQCSD9Ec5dZnYxoRdAUkmGFGz5bEKp4darF0DySDKGc1fI9dImdQHEJ0H3R2iCPfUq1QWQPIvahAQpkYsJ7QA6P31nBxPaAbKtMHlT0EiJYMOFagQoZabvZzljyWcjvVSjRgDjbCQZa6REnSa0ANg56VVogj31bLUAGOVnJUMKzt0eEzYDHNFrQjbAnrvZX6nUZgD42TwbAE2Arpa0DaCmVKUAu+XLzvxadb78l6AUHGsbADysRgCcu2xCfBnPvWgbQKm6Irup2yaEiw8sLoQzgFFdFte4JyCJdAawqysBRoErY8IIAFg8eMRZ0EaWPwCsHAxIIg0ngzsArK4ElNp8rBoTnAFgde1BqwW7mScA78XbndQXqafou9Sa8rPEBL0bC77/iTCAni/Zq+aPiWTu2lfNnhiAxwpUfflZZKzepGFPDPDPtQBmawHM1gKYrQUwW1cP8AfjyenJIZ4BygAAAABJRU5ErkJggg==" y="10"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="72" x="484" y="24">«Lambda»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="84" x="478" y="40.2969">dispense.py</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="10" x="515" y="54.5938">[]</text><rect fill="#FFFFFF" filter="url(#fpzi1p80eeyws)" height="78" style="stroke: #FF9900; stroke-width: 1.5;" width="218" x="583" y="3"/><image height="64" width="64" x="590" xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAIAAAAlC+aJAAABtElEQVR4Xu2avUvEQBDF7x+3tLnSxs4q1XU2lilsLWwDYnGgeCBYrFgIQhwyYYPzNtlFLpOdZR8PjktmN/Pj9ut2s+uNa8cf7vMnxb4Y3tL3BEBfLi6fU9w9fVF8e/+Bt/TNDGUBNIcTJYe+vXvnAAGAkQqmJGcBHh4dNyyh17fvIIBviJqiJGcBKDMZPojyzgdAPL0CqKsCQBXK+g9AVqPQEgCN95Qi2pcRADSiYfDa9pNSACDqLvOZOOpMAfqhm6aYg6kk3tI3JzMC2NUI0MKaKWj+1WhQwlv6ngDM94FyANqhkaD9ClYAUFvC4LXtn+6CANywhDrrS4kKcE5VAKhCWRUAqlDWEsD1zUtzOKHpehAAIxXskwkARC0AtvUfAMIi76+OC6YAmnr7YWspGryqOdsJwLSKADDfhEroxHzJ/DBqfiKrABqqAFCFsioAVKGsCICDbQxnaFslagGwrQsC4JxSzGWy29w1rRGgg+ODoDnY5XbAYb4PlANg/pjVd20hMwfdcwCdoaWEDB9UAc6pCgBVKGsJwPxLf4311y6jFgDbuiAAZkgxB6fHr2rOxPz/gV+YFRj8+GvFVAAAAABJRU5ErkJggg==" y="10"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="134" x="660" y="24">«DynamoDBTable»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="675" y="40.2969">DispenseTable</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="59" x="697.5" y="54.5938">[pk=123]</text><rect fill="#EEEEEE" filter="url(#fpzi1p80eeyws)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="807" x="3" y="116.5664"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="810" y1="116.5664" y2="116.5664"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="810" y1="119.5664" y2="119.5664"/><rect fill="#EEEEEE" filter="url(#fpzi1p80eeyws)" height="23.1328" style="stroke: #000000; stroke-width: 2.0;" width="408" x="202.5" y="106"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="389" x="208.5" y="122.0669">Shadow Request/Response Empty BEFORE Dispense</text><polygon fill="#666666" points="306,169.0703,296,173.0703,306,177.0703,302,173.0703" style="stroke: #666666; stroke-width: 1.0;"/><line style="stroke: #666666; stroke-width: 1.0;" x1="300" x2="486" y1="173.0703" y2="173.0703"/><text fill="#666666" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="130" x="312" y="154.2715">Add "request" object</text><text fill="#666666" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="84" x="312" y="168.2402">desired state</text><polygon fill="#666666" points="682,211.0078,692,215.0078,682,219.0078,686,215.0078" style="stroke: #666666; stroke-width: 1.0;"/><line style="stroke: #666666; stroke-width: 1.0;" x1="487" x2="688" y1="215.0078" y2="215.0078"/><text fill="#666666" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="113" x="494" y="196.209">Store requestId in</text><text fill="#666666" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="117" x="494" y="210.1777">dispenser's record</text><polygon fill="#666666" points="109.5,252.9453,99.5,256.9453,109.5,260.9453,105.5,256.9453" style="stroke: #666666; stroke-width: 1.0;"/><line style="stroke: #666666; stroke-width: 1.0;" x1="103.5" x2="294" y1="256.9453" y2="256.9453"/><text fill="#666666" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="114" x="115.5" y="238.1465">Publish to shadow</text><text fill="#666666" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="71" x="115.5" y="252.1152">/delta topic</text><line style="stroke: #666666; stroke-width: 1.0;" x1="98.5" x2="140.5" y1="284.9141" y2="284.9141"/><line style="stroke: #666666; stroke-width: 1.0;" x1="140.5" x2="140.5" y1="284.9141" y2="297.9141"/><line style="stroke: #666666; stroke-width: 1.0;" x1="99.5" x2="140.5" y1="297.9141" y2="297.9141"/><polygon fill="#666666" points="109.5,293.9141,99.5,297.9141,109.5,301.9141,105.5,297.9141" style="stroke: #666666; stroke-width: 1.0;"/><text fill="#666666" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="93" x="105.5" y="280.084">Dispense drink</text><polygon fill="#666666" points="283,335.8516,293,339.8516,283,343.8516,287,339.8516" style="stroke: #666666; stroke-width: 1.0;"/><line style="stroke: #666666; stroke-width: 1.0;" x1="98.5" x2="289" y1="339.8516" y2="339.8516"/><text fill="#666666" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="140" x="105.5" y="321.0527">Add "response" object</text><text fill="#666666" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="109" x="105.5" y="335.0215">to reported state</text><polygon fill="#666666" points="475,363.8203,485,367.8203,475,371.8203,479,367.8203" style="stroke: #666666; stroke-width: 1.0;"/><line style="stroke: #666666; stroke-width: 1.0;" x1="295" x2="481" y1="367.8203" y2="367.8203"/><text fill="#666666" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="146" x="302" y="362.9902">Send shadow (via Rule)</text><polygon fill="#666666" points="498,405.7578,488,409.7578,498,413.7578,494,409.7578" style="stroke: #666666; stroke-width: 1.0;"/><line style="stroke: #666666; stroke-width: 1.0;" x1="492" x2="693" y1="409.7578" y2="409.7578"/><text fill="#666666" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="124" x="504" y="390.959">Read requestId and</text><text fill="#666666" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="139" x="504" y="404.9277">validate to "response"</text><line style="stroke: #666666; stroke-width: 1.0;" x1="487" x2="529" y1="465.6641" y2="465.6641"/><line style="stroke: #666666; stroke-width: 1.0;" x1="529" x2="529" y1="465.6641" y2="478.6641"/><line style="stroke: #666666; stroke-width: 1.0;" x1="488" x2="529" y1="478.6641" y2="478.6641"/><polygon fill="#666666" points="498,474.6641,488,478.6641,498,482.6641,494,478.6641" style="stroke: #666666; stroke-width: 1.0;"/><text fill="#666666" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="124" x="494" y="432.8965">Dispense complete,</text><text fill="#666666" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="136" x="494" y="446.8652">delete both "request"</text><text fill="#666666" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="142" x="494" y="460.834">and "response objects</text><polygon fill="#666666" points="682,516.6016,692,520.6016,682,524.6016,686,520.6016" style="stroke: #666666; stroke-width: 1.0;"/><line style="stroke: #666666; stroke-width: 1.0;" x1="487" x2="688" y1="520.6016" y2="520.6016"/><text fill="#666666" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="137" x="494" y="501.8027">Delete requestId from</text><text fill="#666666" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="117" x="494" y="515.7715">dispenser's record</text><rect fill="#EEEEEE" filter="url(#fpzi1p80eeyws)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="807" x="3" y="549.168"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="810" y1="549.168" y2="549.168"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="810" y1="552.168" y2="552.168"/><rect fill="#EEEEEE" filter="url(#fpzi1p80eeyws)" height="23.1328" style="stroke: #000000; stroke-width: 2.0;" width="396" x="208.5" y="538.6016"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="377" x="214.5" y="554.6685">Shadow Request/Response Empty AFTER Dispense</text><!--
@startuml




skinparam defaultTextAlignment center

skinparam wrapWidth 200
skinparam maxMessageSize 150

skinparam rectangle {
    StereotypeFontSize 12
}

skinparam Arrow {
    Color #666666
    FontColor #666666
    FontSize 12
}









sprite $IoTGeneric [64x64/16z] {
xPS7ZiGm24MD9mR_-rzuOvafHA0bcbwUIkfB0TpAfq54PhCvzoy26RS2RTrKeAwR1f1U2ldvjV5A1yO6wCmiW6pFSQkklY3DuhqTG4y1mFc21XnAYiECpGP6
Bqaw-9DyaW7s-901gO-9-iGXf3ucvBwV4SBk-rMxyAEwuKpy69sA0_MqF- -lL0oXJmEnFZ40he4lD2Wc_iQdFa-HxqyezXdWHG39-6tGBtq2UAP2pk3izpQW
C7uLM9mk9Hr_cbykzlqxyYVU_qT-7SYU-4iTsFnv-ISjfDtvKyqyoF73xrVCZqJVhvhl2o0B0pAqPFnjqZIHbFSjMaWry6tz1aNBvlscVatyu__dHFxoyLS_
xZ_EL2__GeD4_apzFQZ_pFVVruqVruzVruwVl_d7jVEtw-UFryzVxVmP03FBTluifqlSwhNpzvz_nVhni_W3
}

skinparam rectangle<<IoTGeneric>> {
    BackgroundColor #FFFFFF
    BorderColor #FF9900
}
skinparam participant<<IoTGeneric>> {
    BackgroundColor #FFFFFF
    BorderColor #FF9900
}
sprite $IoTShadow [64x64/16z] {
jPO7pYGh30PjRB3h_WT-RtVG08i6YVv3ANKgmWTOBR-4gifNAJKIoAWcp_5aaYxFi7nfhNfj0P0c3t0WQv6EUW9Lhgb0LPbe1TgJtcqFCwyRA5DVqBoTGe3B
P6sWNEX-6gX1YAYvcygP90-l6tZj2rlbX9sdgKn2vTY9olaTwQgU4CVXXvmexsWqm4zZh7B4wroCF7NXbrlK3l6PN50Eu_HBNv8qbGqBm2zzoAhx-a2gt62n
5nODe1MvHJrOKmY88gN57Kr5F6S3tZTbunRlPG4REq9x1faP4JbPR-95PlUbGFRkwG_QwxvOaGMLWRuG1PTr8mNey1lh2TD8M-iOK8UlqEQvwNxF86Qmi_9K
NkJm9SZrt3IYG5g0BKhgkAarYUbNq7zz0viJT8W6CRuMQGT_zX_bdOi1rHBQYAl4Hx-D-GTpoCaRc_CV_YnOGGvV0yWY7tpV_25MA7FzpKqwMjx82_C_cCg-
VWMY-qH4QstiypVhRSI-VwJr9uqxzlqhsXzPv1rHblCpLahb2GxK_Qz1vOxYEVNrSEGTitvDF7b0Llqmgjhkg2O_Ytw99VulCH9iV8as_VJ7vEg7F2PMFtkC
NbrbHIDqlRLEBm-xRpbJcSaqcGIT-ial8zQ1R_T9ftto6xZQEDMpnRBuKOhbPp-9KLH7TpOR7Cwjtw2-7hJDlnk_0_w79O8ap2nfD_cnSCxll7x98C_hTzu_
MWQwFP8__Ep-hO_9rVyIxRlru_lrw_ly3m
}

skinparam rectangle<<IoTShadow>> {
    BackgroundColor #FFFFFF
    BorderColor #FF9900
}
skinparam participant<<IoTShadow>> {
    BackgroundColor #FFFFFF
    BorderColor #FF9900
}
sprite $Lambda [64x64/16z] {
xPQ7QWGn44CrFV__m-bcPHy63-b5ARTDw1qZXhtxLlhNloecjVsAIT7t-vNkaBw_fhDuap-XVVzycc_o1xJlPmcoxNyBW2BhMQDF1D3fZzO0W7Nyhl8e1U82
g8R_Tl3U0hXjNW7LzmS3UDVDWtyxW7K1t1S0QG4aa6y1KC2cvcKB8262cWPldJrY28TDpKj89xuA1D1SP0P_jHRQ0CFK1k3uKLe626WZVdmQlBL92Tcw01pF
0ArDkdOc8Gs0qLawD4HZamPiEIG0Xnt6yzTL1X0HZOETGOVKF0S0-C7Eed5pywegu2VnkHuEvTRFcHpAntl_cYaBre6VSkYGkBP-pgIX4y21dp8DiPdBtf-0
NwzjjGucNcKxluFaQo_vti6BQwrmoxtle7_zwm4
}

skinparam rectangle<<Lambda>> {
    BackgroundColor #FFFFFF
    BorderColor #FF9900
}
skinparam participant<<Lambda>> {
    BackgroundColor #FFFFFF
    BorderColor #FF9900
}
sprite $DynamoDBTable [64x64/16z] {
xPT50eH030HxFF3__wu5lMMsSQWJLdWCD6vAjswYExoT4f3Q2jmYVabAxlnae_H-XE8xty54xFq49TJvQUu_ll_Jpq59dH-3YTpv-_w_25C05oh00gGf3ZvL
S8puJqw9dU-TYOl4p-DBKQJpYmrPvlyJQGR48qfZHSHXP_Zxv-EN_NvF_9pKf_Ft_lMRhPyiRF-mw_jZ-pUcVtpYZ_VP-OcUt_QFVtP-fda3
}

skinparam rectangle<<DynamoDBTable>> {
    BackgroundColor #FFFFFF
    BorderColor #FF9900
}
skinparam participant<<DynamoDBTable>> {
    BackgroundColor #FFFFFF
    BorderColor #FF9900
}

hide footbox

participant "123\n<size:12>[]</size>" as thing << ($IoTGeneric, #3F8624) IoTGeneric>> order 10
participant "123\n<size:12>[Device Shadow]</size>" as shadow << ($IoTShadow, #3F8624) IoTShadow>> order 20
participant "dispense.py\n<size:12>[]</size>" as dispense << ($Lambda, #D86613) Lambda>> order 30
participant "DispenseTable\n<size:12>[pk=123]</size>" as db << ($DynamoDBTable, #3B48CC) DynamoDBTable>> order 40

== Shadow Request/Response Empty BEFORE Dispense ==

dispense -> shadow : Add "request" object desired state
dispense -> db : Store requestId in dispenser's record
shadow -> thing : Publish to shadow /delta topic
thing -> thing : Dispense drink
thing -> shadow : Add "response" object to reported state
shadow -> dispense : Send shadow (via Rule)
db -> dispense : Read requestId and validate to "response"
dispense -> dispense : Dispense complete, delete both "request" and "response objects
dispense -> db : Delete requestId from dispenser's record

== Shadow Request/Response Empty AFTER Dispense ==
@enduml

PlantUML version 1.2019.06(Fri May 24 17:10:25 GMT 2019)
(APACHE source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 11.0.4+11-post-Ubuntu-1ubuntu218.04.3
Operating System: Linux
OS Version: 4.9.184-linuxkit
Default Encoding: ANSI_X3.4-1968
Language: en
Country: US
--></g></svg>